name: auto-format
on:
  push:
    branches:
      - main
permissions:
  contents: write
jobs:
  auto-format:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up mise
        run: |
          echo MISE_ENV=ci >> "$GITHUB_ENV"
          rm .env.yaml 2>/dev/null || true  # Remove encrypted env file if it exists

      - uses: jdx/mise-action@c37c93293d6b742fc901e1406b8f764f6fb19dac

      - name: Format code
        run: |
          # Format Python code with ruff
          ruff format src/

          # Format all other code with dprint
          dprint fmt

      - name: Commit and push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Auto-format code"
          commit_user_name: "github-actions[bot]"
          commit_user_email: "github-actions[bot]@users.noreply.github.com"
